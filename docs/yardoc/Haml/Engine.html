<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Haml::Engine
  
    &mdash; Haml Documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (E)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Haml.html" title="Haml (module)">Haml</a></span></span>
     &raquo; 
    <span class="title">Engine</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Haml::Engine
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Haml::Engine</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Compiler.html" title="Haml::Compiler (module)">Compiler</a></span>, <span class='object_link'><a href="Parser.html" title="Haml::Parser (module)">Parser</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/haml/engine.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>This is the frontend for using Haml programmatically. It can be directly used by the user by creating a new instance and calling <span class='object_link'><a href="#render-instance_method" title="Haml::Engine#render (method)">#render</a></span> to render the template. For example:</p>

<pre class="code">template = File.read(&#39;templates/really_cool_template.haml&#39;)
haml_engine = Haml::Engine.new(template)
output = haml_engine.render
puts output</pre>

  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Constants included from <span class='object_link'><a href="Util.html" title="Haml::Util (module)">Util</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Util.html#RUBY_ENGINE-constant" title="Haml::Util::RUBY_ENGINE (constant)">RUBY_ENGINE</a></span>, <span class='object_link'><a href="Util.html#RUBY_VERSION-constant" title="Haml::Util::RUBY_VERSION (constant)">RUBY_VERSION</a></span></p>

  
  
  
  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#indentation-instance_method" title="#indentation (instance method)">- (String) <strong>indentation</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The indentation used in the Haml document, or <code>nil</code> if the indentation is ambiguous (for example, for a single-level document).</p></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">- ({Symbol =&gt; Object}) <strong>options</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The options hash.</p></div></span>
  
</li>

    
  </ul>



  
  
  
  
  
  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#def_method-instance_method" title="#def_method (instance method)">- <strong>def_method</strong>(object, name, *local_names) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Defines a method on <code>object</code> with the given name that renders the template and returns the result as a string.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#html4%3F-instance_method" title="#html4? (instance method)">- (Boolean) <strong>html4?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Whether or not the format is HTML4.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#html5%3F-instance_method" title="#html5? (instance method)">- (Boolean) <strong>html5?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Whether or not the format is HTML5.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#html%3F-instance_method" title="#html? (instance method)">- (Boolean) <strong>html?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Whether or not the format is any flavor of HTML.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Engine) <strong>initialize</strong>(template, options = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Precompiles the Haml template.</p></div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#options_for_buffer-instance_method" title="#options_for_buffer (instance method)">- ({Symbol =&gt; Object}) <strong>options_for_buffer</strong> </a>
    

    
  </span>
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a subset of <span class='object_link'><a href="#options-instance_method" title="Haml::Engine#options (method)">#options</a></span>: those that <span class='object_link'><a href="Buffer.html" title="Haml::Buffer (class)">Buffer</a></span> cares about.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#precompiled-instance_method" title="#precompiled (instance method)">- (String) <strong>precompiled</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The source code that is evaluated to produce the Haml document.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#render-instance_method" title="#render (instance method)">- (String) <strong>render</strong>(scope = Object.new, locals = {}, &amp;block) </a>
    

    
      (also: #to_html)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Processes the template and returns the result as a string.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#render_proc-instance_method" title="#render_proc (instance method)">- (Proc) <strong>render_proc</strong>(scope = Object.new, *local_names) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a proc that, when called, renders the template and returns the result as a string.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#xhtml%3F-instance_method" title="#xhtml? (instance method)">- (Boolean) <strong>xhtml?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Whether or not the format is XHTML.</p></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Util.html" title="Haml::Util (module)">Util</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Util.html#abstract-instance_method" title="Haml::Util#abstract (method)">#abstract</a></span>, <span class='object_link'><a href="Util.html#ap_geq%3F-instance_method" title="Haml::Util#ap_geq? (method)">#ap_geq?</a></span>, <span class='object_link'><a href="Util.html#ap_geq_3%3F-instance_method" title="Haml::Util#ap_geq_3? (method)">#ap_geq_3?</a></span>, <span class='object_link'><a href="Util.html#assert_html_safe%21-instance_method" title="Haml::Util#assert_html_safe! (method)">#assert_html_safe!</a></span>, <span class='object_link'><a href="Util.html#av_template_class-instance_method" title="Haml::Util#av_template_class (method)">#av_template_class</a></span>, <span class='object_link'><a href="Util.html#caller_info-instance_method" title="Haml::Util#caller_info (method)">#caller_info</a></span>, <span class='object_link'><a href="Util.html#check_encoding-instance_method" title="Haml::Util#check_encoding (method)">#check_encoding</a></span>, <span class='object_link'><a href="Util.html#check_haml_encoding-instance_method" title="Haml::Util#check_haml_encoding (method)">#check_haml_encoding</a></span>, <span class='object_link'><a href="Util.html#def_static_method-instance_method" title="Haml::Util#def_static_method (method)">#def_static_method</a></span>, <span class='object_link'><a href="Util.html#dump-instance_method" title="Haml::Util#dump (method)">#dump</a></span>, <span class='object_link'><a href="Util.html#enum_cons-instance_method" title="Haml::Util#enum_cons (method)">#enum_cons</a></span>, <span class='object_link'><a href="Util.html#enum_slice-instance_method" title="Haml::Util#enum_slice (method)">#enum_slice</a></span>, <span class='object_link'><a href="Util.html#enum_with_index-instance_method" title="Haml::Util#enum_with_index (method)">#enum_with_index</a></span>, <span class='object_link'><a href="Util.html#flatten-instance_method" title="Haml::Util#flatten (method)">#flatten</a></span>, <span class='object_link'><a href="Util.html#haml_warn-instance_method" title="Haml::Util#haml_warn (method)">#haml_warn</a></span>, <span class='object_link'><a href="Util.html#has%3F-instance_method" title="Haml::Util#has? (method)">#has?</a></span>, <span class='object_link'><a href="Util.html#html_safe-instance_method" title="Haml::Util#html_safe (method)">#html_safe</a></span>, <span class='object_link'><a href="Util.html#inspect_obj-instance_method" title="Haml::Util#inspect_obj (method)">#inspect_obj</a></span>, <span class='object_link'><a href="Util.html#intersperse-instance_method" title="Haml::Util#intersperse (method)">#intersperse</a></span>, <span class='object_link'><a href="Util.html#ironruby%3F-instance_method" title="Haml::Util#ironruby? (method)">#ironruby?</a></span>, <span class='object_link'><a href="Util.html#lcs-instance_method" title="Haml::Util#lcs (method)">#lcs</a></span>, <span class='object_link'><a href="Util.html#load-instance_method" title="Haml::Util#load (method)">#load</a></span>, <span class='object_link'><a href="Util.html#map_hash-instance_method" title="Haml::Util#map_hash (method)">#map_hash</a></span>, <span class='object_link'><a href="Util.html#map_keys-instance_method" title="Haml::Util#map_keys (method)">#map_keys</a></span>, <span class='object_link'><a href="Util.html#map_vals-instance_method" title="Haml::Util#map_vals (method)">#map_vals</a></span>, <span class='object_link'><a href="Util.html#merge_adjacent_strings-instance_method" title="Haml::Util#merge_adjacent_strings (method)">#merge_adjacent_strings</a></span>, <span class='object_link'><a href="Util.html#ord-instance_method" title="Haml::Util#ord (method)">#ord</a></span>, <span class='object_link'><a href="Util.html#paths-instance_method" title="Haml::Util#paths (method)">#paths</a></span>, <span class='object_link'><a href="Util.html#powerset-instance_method" title="Haml::Util#powerset (method)">#powerset</a></span>, <span class='object_link'><a href="Util.html#rails_env-instance_method" title="Haml::Util#rails_env (method)">#rails_env</a></span>, <span class='object_link'><a href="Util.html#rails_root-instance_method" title="Haml::Util#rails_root (method)">#rails_root</a></span>, <span class='object_link'><a href="Util.html#rails_safe_buffer_class-instance_method" title="Haml::Util#rails_safe_buffer_class (method)">#rails_safe_buffer_class</a></span>, <span class='object_link'><a href="Util.html#rails_xss_safe%3F-instance_method" title="Haml::Util#rails_xss_safe? (method)">#rails_xss_safe?</a></span>, <span class='object_link'><a href="Util.html#restrict-instance_method" title="Haml::Util#restrict (method)">#restrict</a></span>, <span class='object_link'><a href="Util.html#ruby1_8%3F-instance_method" title="Haml::Util#ruby1_8? (method)">#ruby1_8?</a></span>, <span class='object_link'><a href="Util.html#ruby1_8_6%3F-instance_method" title="Haml::Util#ruby1_8_6? (method)">#ruby1_8_6?</a></span>, <span class='object_link'><a href="Util.html#scope-instance_method" title="Haml::Util#scope (method)">#scope</a></span>, <span class='object_link'><a href="Util.html#set_eql%3F-instance_method" title="Haml::Util#set_eql? (method)">#set_eql?</a></span>, <span class='object_link'><a href="Util.html#set_hash-instance_method" title="Haml::Util#set_hash (method)">#set_hash</a></span>, <span class='object_link'><a href="Util.html#silence_haml_warnings-instance_method" title="Haml::Util#silence_haml_warnings (method)">#silence_haml_warnings</a></span>, <span class='object_link'><a href="Util.html#silence_warnings-instance_method" title="Haml::Util#silence_warnings (method)">#silence_warnings</a></span>, <span class='object_link'><a href="Util.html#static_method_name-instance_method" title="Haml::Util#static_method_name (method)">#static_method_name</a></span>, <span class='object_link'><a href="Util.html#strip_string_array-instance_method" title="Haml::Util#strip_string_array (method)">#strip_string_array</a></span>, <span class='object_link'><a href="Util.html#substitute-instance_method" title="Haml::Util#substitute (method)">#substitute</a></span>, <span class='object_link'><a href="Util.html#to_hash-instance_method" title="Haml::Util#to_hash (method)">#to_hash</a></span>, <span class='object_link'><a href="Util.html#try_sass-instance_method" title="Haml::Util#try_sass (method)">#try_sass</a></span>, <span class='object_link'><a href="Util.html#version_geq-instance_method" title="Haml::Util#version_geq (method)">#version_geq</a></span>, <span class='object_link'><a href="Util.html#version_gt-instance_method" title="Haml::Util#version_gt (method)">#version_gt</a></span>, <span class='object_link'><a href="Util.html#windows%3F-instance_method" title="Haml::Util#windows? (method)">#windows?</a></span></p>

  
  
  
  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Haml::Engine (class)">Engine</a></span></tt>) <strong>initialize</strong>(template, options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Precompiles the Haml template.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>template</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Haml template</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>{Symbol =&gt; <span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>An options hash; see <a href="../file.HAML_REFERENCE.html#haml_options" title="the Haml options documentation">the Haml options documentation</a></p></div>
      
    </li>
  
</ul>

<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error.html" title="Haml::Error (class)">Haml::Error</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if there&#8217;s a Haml syntax error in the template</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 74</span>

def initialize(template, options = {})
  @options = {
    :suppress_eval =&gt; false,
    :attr_wrapper =&gt; &quot;'&quot;,

    # Don't forget to update the docs in doc-src/HAML_REFERENCE.md
    # if you update these
    :autoclose =&gt; %w[meta img link br hr input area param col base],
    :preserve =&gt; %w[textarea pre code],

    :filename =&gt; '(haml)',
    :line =&gt; 1,
    :ugly =&gt; false,
    :format =&gt; :xhtml,
    :escape_html =&gt; false,
    :escape_attrs =&gt; true,
  }


  template = check_haml_encoding(template) do |msg, line|
    raise Haml::Error.new(msg, line)
  end

  unless ruby1_8?
    @options[:encoding] = Encoding.default_internal || template.encoding
    @options[:encoding] = &quot;utf-8&quot; if @options[:encoding].name == &quot;US-ASCII&quot;
  end
  @options.merge! options.reject {|k, v| v.nil?}
  @index = 0

  unless [:xhtml, :html4, :html5].include?(@options[:format])
    raise Haml::Error, &quot;Invalid output format #{@options[:format].inspect}&quot;
  end

  if @options[:encoding] &amp;&amp; @options[:encoding].is_a?(Encoding)
    @options[:encoding] = @options[:encoding].name
  end

  # :eod is a special end-of-document marker
  @template = (template.rstrip).split(/\r\n|\r|\n/) + [:eod, :eod]
  @template_index = 0
  @to_close_stack = []
  @output_tabs = 0
  @template_tabs = 0
  @flat = false
  @newlines = 0
  @precompiled = ''
  @to_merge = []
  @tab_change  = 0

  compile(parse)
rescue Haml::Error =&gt; e
  if @index || e.line
    e.backtrace.unshift &quot;#{@options[:filename]}:#{(e.line ? e.line + 1 : @index) + @options[:line] - 1}&quot;
  end
  raise
end</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="indentation=-instance_method"></span>
      <span id="indentation-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="indentation-instance_method">
  
    - (<tt>String</tt>) <strong>indentation</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>The indentation used in the Haml document, or <code>nil</code> if the indentation is ambiguous (for example, for a single-level document).</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 33</span>

def indentation
  @indentation
end</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="options=-instance_method"></span>
      <span id="options-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="options-instance_method">
  
    - (<tt>{Symbol =&gt; <span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span>}</tt>) <strong>options</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>The options hash. See <a href="../file.HAML_REFERENCE.html#haml_options" title="the Haml options documentation">the Haml options documentation</a>.</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>{Symbol =&gt; <span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 26</span>

def options
  @options
end</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="def_method-instance_method">
  
    - <strong>def_method</strong>(object, name, *local_names) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Defines a method on <code>object</code> with the given name that renders the template and returns the result as a string.</p>

<p>If <code>object</code> is a class or module, the method will instead by defined as an instance method. For example:</p>

<pre class="code">t = Time.now
Haml::Engine.new(&quot;%p\n  Today&#39;s date is\n  .date= self.to_s&quot;).def_method(t, :render)
t.render #=&gt; &quot;&lt;p&gt;\n  Today&#39;s date is\n  &lt;div class=&#39;date&#39;&gt;Fri Nov 23 18:28:29 -0800 2007&lt;/div&gt;\n&lt;/p&gt;\n&quot;

Haml::Engine.new(&quot;.upcased= upcase&quot;).def_method(String, :upcased_div)
&quot;foobar&quot;.upcased_div #=&gt; &quot;&lt;div class=&#39;upcased&#39;&gt;FOOBAR&lt;/div&gt;\n&quot;</pre>

<p>The first argument of the defined method is a hash of local variable names to values. However, due to an unfortunate Ruby quirk, the local variables which can be assigned must be pre-declared. This is done with the <code>local_names</code> argument. For example:</p>

<pre class="code"># This works
obj = Object.new
Haml::Engine.new(&quot;%p= foo&quot;).def_method(obj, :render, :foo)
obj.render(:foo =&gt; &quot;Hello!&quot;) #=&gt; &quot;&lt;p&gt;Hello!&lt;/p&gt;&quot;

# This doesn&#39;t
obj = Object.new
Haml::Engine.new(&quot;%p= foo&quot;).def_method(obj, :render)
obj.render(:foo =&gt; &quot;Hello!&quot;) #=&gt; NameError: undefined local variable or method `foo&#39;</pre>

<p>Note that Haml modifies the evaluation context (either the scope object or the <code>self</code> object of the scope binding). It extends <span class='object_link'><a href="Helpers.html" title="Haml::Helpers (module)">Helpers</a></span>, and various instance variables are set (all prefixed with <code>haml_</code>).</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>, <tt>Module</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The object on which to define the method</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the method to define</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>local_names</span>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The names of the locals that can be passed to the proc</p></div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


275
276
277
278
279
280</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 275</span>

def def_method(object, name, *local_names)
  method = object.is_a?(Module) ? :module_eval : :instance_eval

  object.send(method, &quot;def #{name}(_haml_locals = {}); #{precompiled_with_ambles(local_names)}; end&quot;,
              @options[:filename], @options[:line])
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="html4?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>html4?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Whether or not the format is HTML4.</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether or not the format is HTML4.</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 46</span>

def html4?
  @options[:format] == :html4
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="html5?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>html5?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Whether or not the format is HTML5.</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether or not the format is HTML5.</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 51</span>

def html5?
  @options[:format] == :html5
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="html?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>html?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Whether or not the format is any flavor of HTML.</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether or not the format is any flavor of HTML.</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 41</span>

def html?
  html4? or html5?
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="options_for_buffer-instance_method">
  
    - (<tt>{Symbol =&gt; <span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span>}</tt>) <strong>options_for_buffer</strong>  <span class="extras">(protected)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns a subset of <span class='object_link'><a href="#options-instance_method" title="Haml::Engine#options (method)">#options</a></span>: those that <span class='object_link'><a href="Buffer.html" title="Haml::Buffer (class)">Buffer</a></span> cares about. All of the values here are such that when <code>#inspect</code> is called on the hash, it can be <code>Kernel#eval</code>ed to get the same result back.</p>

<p>See <a href="../file.HAML_REFERENCE.html#haml_options" title="the Haml options documentation">the Haml options documentation</a>.</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>{Symbol =&gt; <span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The options hash</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293
294
295
296
297
298
299
300
301
302</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 291</span>

def options_for_buffer
  {
    :autoclose =&gt; @options[:autoclose],
    :preserve =&gt; @options[:preserve],
    :attr_wrapper =&gt; @options[:attr_wrapper],
    :ugly =&gt; @options[:ugly],
    :format =&gt; @options[:format],
    :encoding =&gt; @options[:encoding],
    :escape_html =&gt; @options[:escape_html],
    :escape_attrs =&gt; @options[:escape_attrs],
  }
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="precompiled-instance_method">
  
    - (<tt>String</tt>) <strong>precompiled</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>The source code that is evaluated to produce the Haml document.</p>

<p>In Ruby 1.9, this is automatically converted to the correct encoding (see <a href="../file.HAML_REFERENCE.html#encoding-option" title="the &lt;code&gt;:encoding&lt;/code&gt; option">the <code>:encoding</code> option</a>).</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 61</span>

def precompiled
  return @precompiled if ruby1_8?
  encoding = Encoding.find(@options[:encoding])
  return @precompiled.force_encoding(encoding) if encoding == Encoding::BINARY
  return @precompiled.encode(encoding)
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="render-instance_method">
  
    - (<tt>String</tt>) <strong>render</strong>(scope = Object.new, locals = {}, &amp;block) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='to_html-instance_method'>to_html</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>Processes the template and returns the result as a string.</p>

<p><code>scope</code> is the context in which the template is evaluated. If it&#8217;s a <code>Binding</code> or <code>Proc</code> object, Haml uses it as the second argument to <code>Kernel#eval</code>; otherwise, Haml just uses its <code>#instance_eval</code> context.</p>

<p>Note that Haml modifies the evaluation context (either the scope object or the <code>self</code> object of the scope binding). It extends <span class='object_link'><a href="Helpers.html" title="Haml::Helpers (module)">Helpers</a></span>, and various instance variables are set (all prefixed with <code>haml_</code>). For example:</p>

<pre class="code">s = &quot;foobar&quot;
Haml::Engine.new(&quot;%p= upcase&quot;).render(s) #=&gt; &quot;&lt;p&gt;FOOBAR&lt;/p&gt;&quot;

# s now extends Haml::Helpers
s.respond_to?(:html_attrs) #=&gt; true</pre>

<p><code>locals</code> is a hash of local variables to make available to the template. For example:</p>

<pre class="code">Haml::Engine.new(&quot;%p= foo&quot;).render(Object.new, :foo =&gt; &quot;Hello, world!&quot;) #=&gt; &quot;&lt;p&gt;Hello, world!&lt;/p&gt;&quot;</pre>

<p>If a block is passed to render, that block is run when <code>yield</code> is called within the template.</p>

<p>Due to some Ruby quirks, if <code>scope</code> is a <code>Binding</code> or <code>Proc</code> object and a block is given, the evaluation context may not be quite what the user expects. In particular, it&#8217;s equivalent to passing <code>eval(&quot;self&quot;, scope)</code> as <code>scope</code>. This won&#8217;t have an effect in most cases, but if you&#8217;re relying on local variables defined in the context of <code>scope</code>, they won&#8217;t work.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>scope</span>
      
      
        <span class='type'>(<tt>Binding</tt>, <tt>Proc</tt>, <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Object.new</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The context in which the template is evaluated</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>locals</span>
      
      
        <span class='type'>(<tt>{Symbol =&gt; <span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span>}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Local variables that will be made available to the template</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt>#to_proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A block that can be yielded to within the template</p></div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The rendered template</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 173</span>

def render(scope = Object.new, locals = {}, &amp;block)
  buffer = Haml::Buffer.new(scope.instance_variable_get('@haml_buffer'), options_for_buffer)

  if scope.is_a?(Binding) || scope.is_a?(Proc)
    scope_object = eval(&quot;self&quot;, scope)
    scope = scope_object.instance_eval{binding} if block_given?
  else
    scope_object = scope
    scope = scope_object.instance_eval{binding}
  end

  set_locals(locals.merge(:_hamlout =&gt; buffer, :_erbout =&gt; buffer.buffer), scope, scope_object)

  scope_object.instance_eval do
    extend Haml::Helpers
    @haml_buffer = buffer
  end

  eval(precompiled + &quot;;&quot; + precompiled_method_return_value,
    scope, @options[:filename], @options[:line])
ensure
  # Get rid of the current buffer
  scope_object.instance_eval do
    @haml_buffer = buffer.upper if buffer
  end
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="render_proc-instance_method">
  
    - (<tt>Proc</tt>) <strong>render_proc</strong>(scope = Object.new, *local_names) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns a proc that, when called, renders the template and returns the result as a string.</p>

<p><code>scope</code> works the same as it does for render.</p>

<p>The first argument of the returned proc is a hash of local variable names to values. However, due to an unfortunate Ruby quirk, the local variables which can be assigned must be pre-declared. This is done with the <code>local_names</code> argument. For example:</p>

<pre class="code"># This works
Haml::Engine.new(&quot;%p= foo&quot;).render_proc(Object.new, :foo).call :foo =&gt; &quot;Hello!&quot;
  #=&gt; &quot;&lt;p&gt;Hello!&lt;/p&gt;&quot;

# This doesn&#39;t
Haml::Engine.new(&quot;%p= foo&quot;).render_proc.call :foo =&gt; &quot;Hello!&quot;
  #=&gt; NameError: undefined local variable or method `foo&#39;</pre>

<p>The proc doesn&#8217;t take a block; any yields in the template will fail.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>scope</span>
      
      
        <span class='type'>(<tt>Binding</tt>, <tt>Proc</tt>, <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Object.new</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The context in which the template is evaluated</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>local_names</span>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The names of the locals that can be passed to the proc</p></div>
      
    </li>
  
</ul>

<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The proc that will run the template</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229
230
231
232
233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 225</span>

def render_proc(scope = Object.new, *local_names)
  if scope.is_a?(Binding) || scope.is_a?(Proc)
    scope_object = eval(&quot;self&quot;, scope)
  else
    scope_object = scope
    scope = scope_object.instance_eval{binding}
  end

  eval(&quot;Proc.new { |*_haml_locals| _haml_locals = _haml_locals[0] || {};&quot; +
       precompiled_with_ambles(local_names) + &quot;}\n&quot;, scope, @options[:filename], @options[:line])
end</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="xhtml?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>xhtml?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Whether or not the format is XHTML.</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Whether or not the format is XHTML.</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/haml/engine.rb', line 36</span>

def xhtml?
  not html?
end</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Jan 22 23:53:40 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.4 (ruby-1.8.7).
</div>

  </body>
</html>